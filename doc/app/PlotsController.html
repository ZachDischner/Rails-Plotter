<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class PlotsController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/plots_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-plotter">#plotter</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Plot.html">Plot</a>
  
    <li><a href="./PlotsController.html">PlotsController</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class PlotsController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^ <a href="Plot.html">Plot</a>
Controller ^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^*^#</p>

<pre>This controller handles the fetching and organization of data from the database, and then routing that data
  into the correct VIEW pages.
As of now, there are two pages associated with the plotting app.
  1. Index.html.erb. This page  Creates a table full of options that allows the user to select criteria used for
     database querying and data collection.
  2. plotter.html.erb. This page dynamically takes the users selection data criteria, fetches the data for plotting,
     and</pre>

<h1 id="method-i-index-label-%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%3D%2A%23">*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*#</h1>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/plots_controller.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-comment"># Used in the &quot;index&quot; page to activate helper popups that help in development</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:debug</span>] = <span class="ruby-keyword">true</span>

  <span class="ruby-comment"># These tags are to be excluded from any interactions, as they are database utilities, strings, or</span>
  <span class="ruby-comment"># otherwise unplottable data.</span>
  <span class="ruby-identifier">exclude_tags</span> = [<span class="ruby-string">&quot;created_at&quot;</span>,<span class="ruby-string">&quot;updated_at&quot;</span>,<span class="ruby-string">&quot;ticker&quot;</span>]

  <span class="ruby-comment"># Get a single row of info from the database around which to build the user interface</span>
  <span class="ruby-ivar">@plot</span>=<span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>

  <span class="ruby-comment"># Get an array of the collected data as an array of strings. This will be used throughout plotting</span>
  <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@plot</span>.<span class="ruby-identifier">list_vars</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">exclude_tags</span>

  <span class="ruby-comment"># Get Filters, add a &quot;No Filter&quot; option for fast implementation of databases without need for filtering.</span>
  <span class="ruby-comment"># Ideally, this is all taken out later for such applications.</span>
  <span class="ruby-ivar">@filters</span> = [<span class="ruby-string">&quot;No Filter&quot;</span>] <span class="ruby-operator">+</span> <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">select_filter</span>(<span class="ruby-string">&quot;ticker&quot;</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">dd</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">ticker</span>} <span class="ruby-keyword">unless</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@plot</span>.<span class="ruby-identifier">filter_table</span>

  <span class="ruby-ivar">@x_default</span>, <span class="ruby-ivar">@y_default</span>, <span class="ruby-ivar">@filter_default</span>, <span class="ruby-ivar">@feature_default</span> = <span class="ruby-ivar">@plot</span>.<span class="ruby-identifier">default_selections</span>()

<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-plotter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">plotter</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="plotter-source">
            <pre><span class="ruby-comment"># File app/controllers/plots_controller.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">plotter</span>

  <span class="ruby-comment"># If there is no :filter applied to the data, set this param to &quot;No Filter&quot;</span>
  <span class="ruby-comment">#   The   params[:filter]   will be used throughout the RoR plotting app, so if there</span>
  <span class="ruby-comment">#   is no need for a filter, setting   params[:filter] = &quot;No Filter&quot;   will allow the</span>
  <span class="ruby-comment">#   app to function appropriately.</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>]
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>] = <span class="ruby-string">&quot;No Filter&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#   Check if the user has applied the param[:filter] to the plotting data.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">exclude?</span> <span class="ruby-string">&quot;No Filter&quot;</span>

    <span class="ruby-comment"># Convert to array if params[:filter] is a string. The rest of the app expects it as an array</span>
    <span class="ruby-comment">#   This situation arises when the :filter select_tag does NOT include a &quot;:multiple =&gt; true&quot;,</span>
    <span class="ruby-comment">#   which turns the :filter param into a string, instead of an array of strings.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>] = [<span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>]]
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If only one filter, only one query needs to be executed. The results of that query can be placed</span>
    <span class="ruby-comment">#   directly into the    @plot    variable.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_start</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_end</span>])
        <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">between_dates</span>((<span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">convert_date</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_start</span>])).<span class="ruby-identifier">to_s</span>, (<span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">convert_date</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_end</span>])).<span class="ruby-identifier">to_s</span>).
            <span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>]).<span class="ruby-identifier">select_ticker</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">first</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_start</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_end</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-comment"># If the user has input both a START and END value</span>
        <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">between_x</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_start</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:x_end</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>]).<span class="ruby-identifier">select_ticker</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">first</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>]).<span class="ruby-identifier">select_ticker</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">first</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">list_vars</span> <span class="ruby-operator">-</span> [<span class="ruby-string">&quot;Ticker&quot;</span>] <span class="ruby-comment"># Don't want to treat &quot;Ticker&quot; as its own plotting variable, since its a string</span>


    <span class="ruby-keyword">else</span>  <span class="ruby-comment"># Indicates that MULTIPLE     params[:filters]     have been applied</span>

      <span class="ruby-comment"># Each    params[:filter]    member corresponds to a unique query of the database. Each query is evaluated into</span>
      <span class="ruby-comment">#   an instance variable, named after that corresponding :filter member. Later, this app will iterate over all</span>
      <span class="ruby-comment">#   members to plot its data.</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_start</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_end</span>])
          <span class="ruby-identifier">eval</span>(<span class="ruby-string">&quot;@&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;= Plot.between_dates((Plot.first.convert_date(params[:date_start])).to_s, (Plot.first.convert_date(params[:date_end])).to_s).
              select_var(params[:x_var]).select_var(params[:y_var]).select_ticker(p)&quot;</span>   )
        <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_start</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_end</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-comment"># If the user has input both a START and END value</span>
          <span class="ruby-identifier">eval</span>(<span class="ruby-string">&quot;@&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;= Plot.between_x(params[:x_start], params[:x_end]).select_var(params[:x_var]).select_var(params[:y_var]).select_ticker(p)&quot;</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">eval</span>(<span class="ruby-string">&quot;@&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;= Plot.select_var(params[:x_var]).select_var(params[:y_var]).select_ticker(p)&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>



  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_start</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">date_blank</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_end</span>])
      <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">between_dates</span>((<span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">convert_date</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_start</span>])).<span class="ruby-identifier">to_s</span>, (<span class="ruby-constant">Plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">convert_date</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_end</span>])).<span class="ruby-identifier">to_s</span>).
          <span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>])
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_start</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:x_end</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-comment"># If the user has input both a START and END value</span>
      <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">between_x</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_start</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:x_end</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@plot</span> = <span class="ruby-constant">Plot</span>.<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:x_var</span>]).<span class="ruby-identifier">select_var</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:y_var</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@tags</span> = <span class="ruby-ivar">@plot</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">list_vars</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:filter</span>] = [<span class="ruby-string">&quot;No Filter Applied&quot;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Choose which layout to render based on the &quot;feature&quot; parameter.</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:feature</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">'Linear Regression'</span>
      <span class="ruby-ivar">@linear</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@checkboxes</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'Checkboxes'</span>
      <span class="ruby-ivar">@checkboxes</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@linear</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'Both'</span>
      <span class="ruby-ivar">@linear</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@checkboxes</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'None'</span> <span class="ruby-comment"># Default, has no feature. Just a blank plot with no extra interaction.</span>
      <span class="ruby-ivar">@linear</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-ivar">@checkboxes</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- plotter-source -->
          
        </div>

        

        
      </div><!-- plotter-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

